plugins {
    id "com.benjaminsproule.swagger" version "1.0.7"
}

dependencies {
    compile project(':tessera-jaxrs:common-jaxrs')
    implementation project(':config')
    implementation project(':shared')
    implementation project(':tessera-core')
    implementation project(':tessera-admin')
    implementation project(':enclave:enclave-api')

    implementation "org.hibernate:hibernate-validator:6.0.2.Final"

    implementation 'javax.ws.rs:javax.ws.rs-api'
    implementation 'io.swagger:swagger-annotations'

    implementation 'javax.servlet:javax.servlet-api'
    implementation 'org.apache.commons:commons-lang3'
    implementation 'javax.persistence:javax.persistence-api'
    implementation project(':encryption:encryption-api')

    implementation 'io.swagger:swagger-annotations'
    implementation 'javax.ws.rs:javax.ws.rs-api'

    testImplementation "org.glassfish.jersey.test-framework:jersey-test-framework-core"
    testImplementation "org.glassfish.jersey.test-framework.providers:jersey-test-framework-provider-grizzly2"
    testImplementation 'org.glassfish.jersey.media:jersey-media-json-processing'
    testImplementation 'org.glassfish.jersey.media:jersey-media-moxy'
    testImplementation "org.glassfish.jersey.inject:jersey-hk2:2.27"

    implementation project(':service-locator:service-locator-api')
    runtimeOnly project(':service-locator:service-locator-spring')
    testImplementation project(':test-utils:mock-service-locator')
}



swagger {

    apiSource {
        springmvc = false

        schemes = ['http', 'https']
        host = 'localhost:8080'
        basePath = '/'
        outputFormats = ['json']
        //attachSwaggerArtifact = true

        locations = ['com.quorum.tessera.q2t','com.quorum.tessera.api.common']
        info {
            title = 'Tessera rest'
            version = project.version
            license {
                url = 'http://www.apache.org/licenses/LICENSE-2.0.html'
                name = 'Apache 2.0'
            }
        }

        swaggerDirectory = ''+ project.buildDir +'/resources/main'
        //templatePath = '../src/main/swagger/strapdown.html.hbs'
       // outputPath = 'build/resources/main/swagger/swagger.html'
        swaggerFileName = 'swagger'

    }

    apiSource {
        springmvc = false

        schemes = ['http', 'https']
        host = 'localhost:8080'
        basePath = '/'
        outputFormats = ['json']
        //attachSwaggerArtifact = true

        locations = ['com.quorum.tessera.q2t','com.quorum.tessera.api.common']
        info {
            title = 'Tessera rest'
            version = project.version
            license {
                url = 'http://www.apache.org/licenses/LICENSE-2.0.html'
                name = 'Apache 2.0'
            }
        }

        swaggerDirectory = ''+ project.buildDir +'/resources/main'
        templatePath =  ''+ rootProject.rootDir +'/tessera-jaxrs/src/main/swagger/strapdown.html.hbs'
        outputPath = ''+ project.buildDir +'/resources/main/swagger.html'
        swaggerFileName = 'swagger'

    }

}

task loaddeps() {

    def urls = []
    project.configurations.compileClasspath.resolve().flatten().each {
        urls += it.toURI().toURL()
    }
    urls.each {
        buildscript.classLoader.addURL it
    }

}

description = 'transaction-jaxrs'

generateSwaggerDocumentation.dependsOn(loaddeps)
jar.dependsOn(generateSwaggerDocumentation)